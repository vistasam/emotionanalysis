/**
 * Javascript to initialise the recognition of a student facial expression.
 *
 * @module     block_emotionanalysis/prevActivityChecker
 * @copyright  2023 Rohit <rx18008@edu.rta.lv>
 * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
 */
define("block_emotionanalysis/prevActivityChecker",["jquery","core/ajax","./recognition","core/modal_factory","core/modal_events","core/str","./youTubeManager"],(function($,Ajax,recognition,ModalFactory,ModalEvents,String,youTubeManager){let totalDuration,request,requestData,unfinishActivityText=String.get_string("unfinish_activity_text","block_emotionanalysis"),finishActivityText=String.get_string("finished_activity_text","block_emotionanalysis"),videoType=recognition.value;function previousActivityChecker(){requestData={values:{courseId:recognition.courseId,deleteConfirmation:0,instanceId:recognition.instanceId,resourceId:recognition.resourceId}},request={methodname:"blocks_emotionanalysis_prev_activity_checker",args:requestData},Ajax.call([request])[0].done((function(data){if(data.activity_finish_date)showModal(data.timestamp,finishActivityText,data.activity_finish_date,videoType);else{let totalDuration=recognition.videoElement.duration;isNaN(totalDuration)&&location.reload(),null!==data.timestamp&&Math.abs(totalDuration-data.timestamp)&&showModal(data.timestamp,unfinishActivityText,data.activity_finish_date,videoType)}})).fail((function(data){console.log(data)}))}function showModal(timestamp,msgText,activityFinishStatus,videoType){ModalFactory.create({type:ModalFactory.types.SAVE_CANCEL,title:String.get_string("previous_activity","block_emotionanalysis"),body:msgText}).then((function(modal){activityFinishStatus?(modal.setSaveButtonText("No"),modal.modal.find('.btn-secondary[data-action="cancel"]').text("Yes")):(modal.setSaveButtonText("Yes"),modal.modal.find('.btn-secondary[data-action="cancel"]').text("No"));let root=modal.getRoot();root.on(ModalEvents.save,(function(){17===videoType?youTubeManager.player.seekTo(timestamp,!1):recognition.videoElement.currentTime=timestamp})),root.on(ModalEvents.cancel,(function(){modalHandler(timestamp,activityFinishStatus)})),root.on(ModalEvents.outsideClick,(function(){modalHandler(timestamp,activityFinishStatus)})),modal.modal.find(".close").hide(),modal.show()}))}function modalHandler(timestamp,activityFinishStatus){ModalFactory.create({type:ModalFactory.types.SAVE_CANCEL,title:String.get_string("confirmation_title","block_emotionanalysis"),body:String.get_string("confirmation_warning","block_emotionanalysis")}).then((function(modal){modal.setSaveButtonText(String.get_string("confirmation_yes","block_emotionanalysis")),activityFinishStatus?modal.modal.find('.btn-secondary[data-action="cancel"]').text("No"):modal.modal.find('.btn-secondary[data-action="cancel"]').text("No I will Resume");let root=modal.getRoot();root.on(ModalEvents.save,(function(){requestData.values.deleteConfirmation=1,Ajax.call([request])[0].done((function(data){console.log(data)}))})),root.on(ModalEvents.cancel,(function(){activityFinishStatus||(recognition.lectureVideo.currentTime=timestamp)})),root.on(ModalEvents.outsideClick,(function(){showModal(timestamp,activityFinishStatus?finishActivityText:unfinishActivityText,activityFinishStatus)})),modal.modal.find(".close").hide(),modal.show()}))}19===videoType?(totalDuration=recognition.videoElement.duration,isNaN(totalDuration)&&location.reload(),previousActivityChecker()):youTubeManager.readyPromise.then((()=>{youTubeManager.player.addEventListener("onReady",(function(event){totalDuration=youTubeManager.totalDuration,previousActivityChecker()}))}))}));

//# sourceMappingURL=prevActivityChecker.min.js.map