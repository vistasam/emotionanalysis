{"version":3,"file":"sessionTracker.min.js","sources":["../src/sessionTracker.js"],"sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * Javascript to initialise the recognition of a student facial expression.\n *\n * @module     block_emotionanalysis/recognition\n * @copyright  2023 Rohit <rx18008@edu.rta.lv>\n * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\n// eslint-disable-next-line no-unused-vars\ndefine(['jquery', './recognition', 'core/ajax','./youTubeManager'], function ($, recognition, Ajax,youTubeManager) {\n    let moduleType = recognition.value;\n    let videoElement = recognition.videoElement;\n    let requestData = {\n        \"values\": {\n            courseId: recognition.courseId,\n            instanceId: recognition.instanceId,\n            resourceId: recognition.resourceId,\n        }\n    };\n    // eslint-disable-next-line no-unused-vars\n    let request = {\n        methodname: 'blocks_emotionanalysis_session_tracker',\n        args: requestData,\n    };\n    if (moduleType === 17) {\n        // eslint-disable-next-line no-undef,promise/catch-or-return\n        youTubeManager.readyPromise.then(() => {\n            // eslint-disable-next-line no-unused-vars\n            youTubeManager.player.addEventListener('onStateChange', function(event) {\n                if (event.data === 2) {\n                    let lastActiveTime = youTubeManager.currentTime;\n                    sessionTracker(lastActiveTime);\n                }\n            });\n        });\n    } else if (moduleType === 19) {\n        videoElement.addEventListener('pause', () => {\n            let lastActiveTime = videoElement.currentTime;\n            sessionTracker(lastActiveTime);\n        });\n    }\n    /**\n     *Function to send the session Tracker Time\n     * @param {int} lastActiveTime\n     */\n    function sessionTracker(lastActiveTime) {\n        let requestData = {\n            \"values\": {\n                courseId: recognition.courseId,\n                lastActiveTime: Math.floor(lastActiveTime),\n                instanceId: recognition.instanceId,\n                resourceId: recognition.resourceId,\n            }\n        };\n        // eslint-disable-next-line no-unused-vars\n        let request = {\n            methodname: 'blocks_emotionanalysis_session_tracker',\n            args: requestData,\n        };\n        Ajax.call([request])[0].done(function (data) {\n            // eslint-disable-next-line no-console\n            console.log(data);\n        }).fail(function(data) {\n            // eslint-disable-next-line no-console\n            console.log(data.errorcode);\n        });\n    }\n});"],"names":["define","$","recognition","Ajax","youTubeManager","moduleType","value","videoElement","courseId","instanceId","resourceId","sessionTracker","lastActiveTime","request","methodname","args","Math","floor","call","done","data","console","log","fail","errorcode","readyPromise","then","player","addEventListener","event","currentTime"],"mappings":";;;;;;;AAuBAA,8CAAO,CAAC,SAAU,gBAAiB,YAAY,qBAAqB,SAAUC,EAAGC,YAAaC,KAAKC,oBAC3FC,WAAaH,YAAYI,MACzBC,aAAeL,YAAYK,aAGbL,YAAYM,SACVN,YAAYO,WACZP,YAAYQ,oBA6BvBC,eAAeC,oBAUhBC,QAAU,CACVC,WAAY,yCACZC,KAXc,QACJ,CACNP,SAAUN,YAAYM,SACtBI,eAAgBI,KAAKC,MAAML,gBAC3BH,WAAYP,YAAYO,WACxBC,WAAYR,YAAYQ,cAQhCP,KAAKe,KAAK,CAACL,UAAU,GAAGM,MAAK,SAAUC,MAEnCC,QAAQC,IAAIF,SACbG,MAAK,SAASH,MAEbC,QAAQC,IAAIF,KAAKI,cAxCN,KAAfnB,WAEAD,eAAeqB,aAAaC,MAAK,KAE7BtB,eAAeuB,OAAOC,iBAAiB,iBAAiB,SAASC,UAC1C,IAAfA,MAAMT,KAAY,CAElBT,eADqBP,eAAe0B,oBAK1B,KAAfzB,YACPE,aAAaqB,iBAAiB,SAAS,KAEnCjB,eADqBJ,aAAauB"}